{% extends "main/base_generic.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block script %}
{{ block.super }}
<script src="{% static 'selective_transfer/selective_transfer.js' %}"></script>
{% endblock %}

{% block container %}
<h4 class="mb-3">Select studies to transfer</h4>

<form
    method="POST"
    action=""
    novalidate="true"
>
    {% crispy form %}

    <input type="submit" class="d-none" name="action" value="query" />

    {% if not query and not transfer %}
        <div class="alert alert-primary mt-3" role="alert">
            Choose a DICOM source and enter your search
        </div>
    {% endif %}

    {% if query and not query_results %}
        <div class="alert alert-secondary mt-3" role="alert">
            No studies for your query found. Try with other search terms.
        </div>
    {% endif %}

    {% if query and query_results %}
        {% include "selective_transfer/_query_results_table.html" %}

        <button type="submit" class="btn btn-primary" name="action" value="transfer">
            Start Transfer
        </button>
    {% endif %}

    {% if transfer and error %}
        <div
            class="alert alert-danger mt-3"
            role="alert"
        >
         {{ error }}
        </div>
    {% endif %}

    {% if transfer and not error %}
        <div
            class="alert alert-success mt-3"
            role="alert"
        >
            Successfully submitted transfer job with
            <a href="{{ object.get_absolute_url}}">ID {{ object.id }}</a>
        </div>
    {% endif %}
</form>
{% endblock %}
